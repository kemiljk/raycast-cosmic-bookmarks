var _=Object.defineProperty;var S=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var U=(t,r,n)=>r in t?_(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,w=(t,r)=>{for(var n in r||(r={}))I.call(r,n)&&U(t,n,r[n]);if(S)for(var n of S(r))B.call(r,n)&&U(t,n,r[n]);return t};var s=(t,r,n)=>new Promise((e,i)=>{var o=p=>{try{m(n.next(p))}catch($){i($)}},E=p=>{try{m(n.throw(p))}catch($){i($)}},m=p=>p.done?e(p.value):Promise.resolve(p.value).then(o,E);m((n=n.apply(t,r)).next())});var R={production:{v3:{apiUrl:"https://api.cosmicjs.com/v3",uploadUrl:"https://workers.cosmicjs.com/v3"}},staging:{v3:{apiUrl:"https://api.cosmic-staging.com/v3",uploadUrl:"https://workers.cosmic-staging.com/v3"}}},k=R;function A(t){if(t.custom){if(!t.custom.apiUrl||!t.custom.uploadUrl)throw new Error("apiUrl or uploadUrl is missing from 'custom' option");return{apiUrl:t.custom.apiUrl,uploadUrl:t.custom.uploadUrl}}if(!t.apiVersion||!["v3"].includes(t.apiVersion))throw new Error("apiVersion value can only be from 'v1', 'v2' & 'v3'");if(!t.apiEnvironment||!["production","staging"].includes(t.apiEnvironment))throw new Error("apiEnvironment value can only be from 'production' & 'staging'");return k[t.apiEnvironment][t.apiVersion]}import L from"form-data";var D={POST:"post",GET:"get",FETCH:"fetch",PUT:"put",PATCH:"patch",DELETE:"delete"},a=D;import q from"axios";var d=(t,r,n,e)=>q({method:t,url:r,data:n,headers:e}).then(o=>o.data).catch(o=>{throw o.response?o.response.data:o.response});function c(t){if(t&&t.trim())return{Authorization:`Bearer ${t}`};throw new Error("'writeKey' should be a valid string")}import C from"axios";var P=(t,r,n,e)=>C({method:t,url:r,data:n,headers:e});var l=t=>new Promise((r,n)=>{P(a.GET,t).then(e=>r(e.data)).catch(e=>n(e.response?e.response.data:e.response))});var u=class{constructor(r){this.endpoint="";this.endpoint=r}props(r){let n=r;return Array.isArray(n)&&(n=n.filter(e=>typeof e=="string").map(e=>e.trim()).filter(e=>!!e).toString()),this.endpoint+=`&props=${n}`,this}sort(r){return this.endpoint+=`&sort=${r}`,this}skip(r){return this.endpoint+=`&skip=${r}`,this}useCache(){return this.endpoint+="&use_cache=true",this}};var g=class extends u{limit(r){return this.endpoint+=`&limit=${r}`,this}then(r,n){return s(this,null,function*(){l(this.endpoint).then(e=>r(e,null)).catch(e=>{typeof n=="function"?n(e):r(null,e)})})}};var b=class extends u{then(r,n){return s(this,null,function*(){l(this.endpoint).then(e=>r({media:e.media&&e.media.length?e.media[0]:null},null)).catch(e=>{typeof n=="function"?n(e):r(null,e)})})}};var j,H=(t,r)=>({find(e){let i=`${r.apiUrl}/buckets/${t.bucketSlug}/media?read_key=${t.readKey}${e?`&query=${encodeURI(JSON.stringify(e))}`:""}`;return new g(i)},findOne(e){let i=`${r.apiUrl}/buckets/${t.bucketSlug}/media?read_key=${t.readKey}&limit=1${e?`&query=${encodeURI(JSON.stringify(e))}`:""}`;return new b(i)},insertOne(e){return s(this,null,function*(){let i=`${r.uploadUrl}/buckets/${t.bucketSlug}/media`,o=new L;return e.media.buffer?o.append("media",e.media.buffer,e.media.originalname):o.append("media",e.media,e.media.name),t.writeKey&&o.append("write_key",t.writeKey),e.folder&&o.append("folder",e.folder),e.metadata&&o.append("metadata",JSON.stringify(e.metadata)),e.trigger_webhook&&o.append("trigger_webhook",e.trigger_webhook.toString()),(m=>new Promise((p,$)=>{e.media.buffer?m.getLength((x,G)=>{x&&$(x);let M=w({"Content-Length":G},m.getHeaders());p(M)}):p({"Content-Type":"multipart/form-data"})}))(o).then(m=>{let p=m;return t.writeKey&&(p.Authorization=`Bearer ${t.writeKey}`),d(a.POST,i,o,p)}).catch(m=>{throw m.response.data})})},updateOne(e,i){return s(this,null,function*(){let o=`${r.apiUrl}/buckets/${t.bucketSlug}/media/${e}`;return j=c(t.writeKey),d(a.PATCH,o,i,j)})},deleteOne(e,i=!1){return s(this,null,function*(){let o=`${r.apiUrl}/buckets/${t.bucketSlug}/media/${e}${i?"?trigger_webhook=true":""}`;return j=c(t.writeKey),d(a.DELETE,o,null,j)})}});var h=class extends u{depth(r){return this.endpoint+=`&depth=${r}`,this}status(r){return this.endpoint+=`&status=${r}`,this}after(r){return this.endpoint+=`&after=${r}`,this}};var O=class extends h{limit(r){return this.endpoint+=`&limit=${r}`,this}then(r,n){return s(this,null,function*(){l(this.endpoint).then(e=>r(e,null)).catch(e=>{typeof n=="function"?n(e):r(null,e)})})}};var T=class extends h{then(r,n){return s(this,null,function*(){l(this.endpoint).then(e=>r({object:e.objects&&e.objects.length?e.objects[0]:null},null)).catch(e=>{typeof n=="function"?n(e):r(null,e)})})}};var f,K=(t,r)=>({find(e){let i=`${r.apiUrl}/buckets/${t.bucketSlug}/objects?read_key=${t.readKey}${e?`&query=${encodeURI(JSON.stringify(e))}`:""}`;return new O(i)},findOne(e){let i=`${r.apiUrl}/buckets/${t.bucketSlug}/objects?read_key=${t.readKey}&limit=1${e?`&query=${encodeURI(JSON.stringify(e))}`:""}`;return new T(i)},insertOne(e){return s(this,null,function*(){let i=`${r.apiUrl}/buckets/${t.bucketSlug}/objects`;return f=c(t.writeKey),d(a.POST,i,e,f)})},updateOne(e,i){return s(this,null,function*(){let o=`${r.apiUrl}/buckets/${t.bucketSlug}/objects/${e}`;return f=c(t.writeKey),d(a.PATCH,o,i,f)})},deleteOne(e,i=!1){return s(this,null,function*(){let o=`${r.apiUrl}/buckets/${t.bucketSlug}/objects/${e}${i?"?trigger_webhook=true":""}`;return f=c(t.writeKey),d(a.DELETE,o,null,f)})}});var y,v=(t,r)=>({find(){let e=`${r.apiUrl}/buckets/${t.bucketSlug}/object-types?read_key=${t.readKey}`;return d(a.GET,e)},findOne(e){let i=`${r.apiUrl}/buckets/${t.bucketSlug}/object-types/${e}?read_key=${t.readKey}`;return d(a.GET,i)},insertOne(e){return s(this,null,function*(){let i=`${r.apiUrl}/buckets/${t.bucketSlug}/object-types`;return y=c(t.writeKey),d(a.POST,i,e,y)})},updateOne(e,i){return s(this,null,function*(){let o=`${r.apiUrl}/buckets/${t.bucketSlug}/object-types/${e}`;return y=c(t.writeKey),d(a.PATCH,o,i,y)})},deleteOne(e){return s(this,null,function*(){let i=`${r.apiUrl}/buckets/${t.bucketSlug}/object-types/${e}`;return y=c(t.writeKey),d(a.DELETE,i,null,y)})}});var J=t=>{let r=w({apiVersion:"v3",apiEnvironment:"production"},t),n=A(r);return{objects:K(r,n),objectTypes:v(r,n),media:H(r,n)}},N=J;export{N as createBucketClient};
