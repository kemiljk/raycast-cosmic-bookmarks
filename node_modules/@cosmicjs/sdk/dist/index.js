"use strict";var J=Object.create;var g=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames,k=Object.getOwnPropertySymbols,W=Object.getPrototypeOf,P=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var A=(e,r,n)=>r in e?g(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n,j=(e,r)=>{for(var n in r||(r={}))P.call(r,n)&&A(e,n,r[n]);if(k)for(var n of k(r))z.call(r,n)&&A(e,n,r[n]);return e};var F=(e,r)=>{for(var n in r)g(e,n,{get:r[n],enumerable:!0})},H=(e,r,n,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of V(r))!P.call(e,i)&&i!==n&&g(e,i,{get:()=>r[i],enumerable:!(t=N(r,i))||t.enumerable});return e};var x=(e,r,n)=>(n=e!=null?J(W(e)):{},H(r||!e||!e.__esModule?g(n,"default",{value:e,enumerable:!0}):n,e)),Q=e=>H(g({},"__esModule",{value:!0}),e);var s=(e,r,n)=>new Promise((t,i)=>{var o=p=>{try{m(n.next(p))}catch($){i($)}},S=p=>{try{m(n.throw(p))}catch($){i($)}},m=p=>p.done?t(p.value):Promise.resolve(p.value).then(o,S);m((n=n.apply(e,r)).next())});var ee={};F(ee,{createBucketClient:()=>q});module.exports=Q(ee);var X={production:{v3:{apiUrl:"https://api.cosmicjs.com/v3",uploadUrl:"https://workers.cosmicjs.com/v3"}},staging:{v3:{apiUrl:"https://api.cosmic-staging.com/v3",uploadUrl:"https://workers.cosmic-staging.com/v3"}}},K=X;function v(e){if(e.custom){if(!e.custom.apiUrl||!e.custom.uploadUrl)throw new Error("apiUrl or uploadUrl is missing from 'custom' option");return{apiUrl:e.custom.apiUrl,uploadUrl:e.custom.uploadUrl}}if(!e.apiVersion||!["v3"].includes(e.apiVersion))throw new Error("apiVersion value can only be from 'v1', 'v2' & 'v3'");if(!e.apiEnvironment||!["production","staging"].includes(e.apiEnvironment))throw new Error("apiEnvironment value can only be from 'production' & 'staging'");return K[e.apiEnvironment][e.apiVersion]}var I=x(require("form-data"));var Y={POST:"post",GET:"get",FETCH:"fetch",PUT:"put",PATCH:"patch",DELETE:"delete"},a=Y;var G=x(require("axios"));var d=(e,r,n,t)=>(0,G.default)({method:e,url:r,data:n,headers:t}).then(o=>o.data).catch(o=>{throw o.response?o.response.data:o.response});function c(e){if(e&&e.trim())return{Authorization:`Bearer ${e}`};throw new Error("'writeKey' should be a valid string")}var M=x(require("axios")),_=(e,r,n,t)=>(0,M.default)({method:e,url:r,data:n,headers:t});var l=e=>new Promise((r,n)=>{_(a.GET,e).then(t=>r(t.data)).catch(t=>n(t.response?t.response.data:t.response))});var u=class{constructor(r){this.endpoint="";this.endpoint=r}props(r){let n=r;return Array.isArray(n)&&(n=n.filter(t=>typeof t=="string").map(t=>t.trim()).filter(t=>!!t).toString()),this.endpoint+=`&props=${n}`,this}sort(r){return this.endpoint+=`&sort=${r}`,this}skip(r){return this.endpoint+=`&skip=${r}`,this}useCache(){return this.endpoint+="&use_cache=true",this}};var b=class extends u{limit(r){return this.endpoint+=`&limit=${r}`,this}then(r,n){return s(this,null,function*(){l(this.endpoint).then(t=>r(t,null)).catch(t=>{typeof n=="function"?n(t):r(null,t)})})}};var O=class extends u{then(r,n){return s(this,null,function*(){l(this.endpoint).then(t=>r({media:t.media&&t.media.length?t.media[0]:null},null)).catch(t=>{typeof n=="function"?n(t):r(null,t)})})}};var E,B=(e,r)=>({find(t){let i=`${r.apiUrl}/buckets/${e.bucketSlug}/media?read_key=${e.readKey}${t?`&query=${encodeURI(JSON.stringify(t))}`:""}`;return new b(i)},findOne(t){let i=`${r.apiUrl}/buckets/${e.bucketSlug}/media?read_key=${e.readKey}&limit=1${t?`&query=${encodeURI(JSON.stringify(t))}`:""}`;return new O(i)},insertOne(t){return s(this,null,function*(){let i=`${r.uploadUrl}/buckets/${e.bucketSlug}/media`,o=new I.default;return t.media.buffer?o.append("media",t.media.buffer,t.media.originalname):o.append("media",t.media,t.media.name),e.writeKey&&o.append("write_key",e.writeKey),t.folder&&o.append("folder",t.folder),t.metadata&&o.append("metadata",JSON.stringify(t.metadata)),t.trigger_webhook&&o.append("trigger_webhook",t.trigger_webhook.toString()),(m=>new Promise((p,$)=>{t.media.buffer?m.getLength((U,C)=>{U&&$(U);let L=j({"Content-Length":C},m.getHeaders());p(L)}):p({"Content-Type":"multipart/form-data"})}))(o).then(m=>{let p=m;return e.writeKey&&(p.Authorization=`Bearer ${e.writeKey}`),d(a.POST,i,o,p)}).catch(m=>{throw m.response.data})})},updateOne(t,i){return s(this,null,function*(){let o=`${r.apiUrl}/buckets/${e.bucketSlug}/media/${t}`;return E=c(e.writeKey),d(a.PATCH,o,i,E)})},deleteOne(t,i=!1){return s(this,null,function*(){let o=`${r.apiUrl}/buckets/${e.bucketSlug}/media/${t}${i?"?trigger_webhook=true":""}`;return E=c(e.writeKey),d(a.DELETE,o,null,E)})}});var h=class extends u{depth(r){return this.endpoint+=`&depth=${r}`,this}status(r){return this.endpoint+=`&status=${r}`,this}after(r){return this.endpoint+=`&after=${r}`,this}};var T=class extends h{limit(r){return this.endpoint+=`&limit=${r}`,this}then(r,n){return s(this,null,function*(){l(this.endpoint).then(t=>r(t,null)).catch(t=>{typeof n=="function"?n(t):r(null,t)})})}};var w=class extends h{then(r,n){return s(this,null,function*(){l(this.endpoint).then(t=>r({object:t.objects&&t.objects.length?t.objects[0]:null},null)).catch(t=>{typeof n=="function"?n(t):r(null,t)})})}};var f,R=(e,r)=>({find(t){let i=`${r.apiUrl}/buckets/${e.bucketSlug}/objects?read_key=${e.readKey}${t?`&query=${encodeURI(JSON.stringify(t))}`:""}`;return new T(i)},findOne(t){let i=`${r.apiUrl}/buckets/${e.bucketSlug}/objects?read_key=${e.readKey}&limit=1${t?`&query=${encodeURI(JSON.stringify(t))}`:""}`;return new w(i)},insertOne(t){return s(this,null,function*(){let i=`${r.apiUrl}/buckets/${e.bucketSlug}/objects`;return f=c(e.writeKey),d(a.POST,i,t,f)})},updateOne(t,i){return s(this,null,function*(){let o=`${r.apiUrl}/buckets/${e.bucketSlug}/objects/${t}`;return f=c(e.writeKey),d(a.PATCH,o,i,f)})},deleteOne(t,i=!1){return s(this,null,function*(){let o=`${r.apiUrl}/buckets/${e.bucketSlug}/objects/${t}${i?"?trigger_webhook=true":""}`;return f=c(e.writeKey),d(a.DELETE,o,null,f)})}});var y,D=(e,r)=>({find(){let t=`${r.apiUrl}/buckets/${e.bucketSlug}/object-types?read_key=${e.readKey}`;return d(a.GET,t)},findOne(t){let i=`${r.apiUrl}/buckets/${e.bucketSlug}/object-types/${t}?read_key=${e.readKey}`;return d(a.GET,i)},insertOne(t){return s(this,null,function*(){let i=`${r.apiUrl}/buckets/${e.bucketSlug}/object-types`;return y=c(e.writeKey),d(a.POST,i,t,y)})},updateOne(t,i){return s(this,null,function*(){let o=`${r.apiUrl}/buckets/${e.bucketSlug}/object-types/${t}`;return y=c(e.writeKey),d(a.PATCH,o,i,y)})},deleteOne(t){return s(this,null,function*(){let i=`${r.apiUrl}/buckets/${e.bucketSlug}/object-types/${t}`;return y=c(e.writeKey),d(a.DELETE,i,null,y)})}});var Z=e=>{let r=j({apiVersion:"v3",apiEnvironment:"production"},e),n=v(r);return{objects:R(r,n),objectTypes:D(r,n),media:B(r,n)}},q=Z;0&&(module.exports={createBucketClient});
